commit 535c49a2e28ef129da8bd76b2b79e7c89c04a18c
Author: Hrvoje Ribicic <riba@google.com>
Date:   Tue Dec 22 18:01:29 2015 +0000

    Redact the DRBD secret in instance queries
    
    This patch is a modified version of 6e94ad764469.
    
    As the DRBD secret should be used only by Ganeti internals, replacing
    the actual secret with None does not hamper Ganeti's work, while
    preventing the secret from being leaked.
    
    Signed-off-by: Hrvoje Ribicic <riba@google.com>
    Reviewed-by: Klaus Aehlig <aehlig@google.com>

--- a/lib/cmdlib/instance_query.py
+++ b/lib/cmdlib/instance_query.py
@@ -164,6 +164,7 @@
 
     """
     drbd_info = None
+    output_logical_id = dev.logical_id
     if dev.dev_type in constants.DTS_DRBD:
       # we change the snode then (otherwise we use the one passed in)
       if dev.logical_id[0] == instance.primary_node:
@@ -180,8 +181,8 @@
         "secondary_node": node_uuid2name_fn(snode_uuid),
         "secondary_minor": snode_minor,
         "port": dev.logical_id[2],
-        "secret": dev.logical_id[5],
       }
+      output_logical_id = dev.logical_id[:-1] + (None,)
 
     dev_pstatus = self._ComputeBlockdevStatus(instance.primary_node,
                                               instance, dev)
@@ -198,7 +199,7 @@
     return {
       "iv_name": dev.iv_name,
       "dev_type": dev.dev_type,
-      "logical_id": dev.logical_id,
+      "logical_id": output_logical_id,
       "drbd_info": drbd_info,
       "pstatus": dev_pstatus,
       "sstatus": dev_sstatus,
