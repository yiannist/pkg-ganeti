.\" This manpage has been automatically generated by docbook2man 
.\" from a DocBook document.  This tool can be found at:
.\" <http://shell.ipoline.com/~elmert/comp/docbook2X/> 
.\" Please send any bug reports, improvements, comments, patches, 
.\" etc. to Steve Cheng <steve@ggi-project.org>.
.TH "GNT-BACKUP" "8" "22 July 2008" "ganeti 1.2" ""

.SH NAME
gnt-backup \- ganeti instance import/export
.SH SYNOPSIS

\fBgnt-backup \fR \fBcommand\fR [ \fBarguments...\fR ]

.SH "DESCRIPTION"
.PP
The \fBgnt-backup\fR is used for importing and exporting
instances and their configuration from a ganeti system. It is useful for
backing instances up and also to migrate them between clusters.
.SH "COMMANDS"
.SS "EXPORT"

\fBexport\fR \fB-n \fInode\fB\fR [ \fB--noshutdown\fR ] \fB\fIinstance\fB\fR

.PP
Exports an instance to the target node. All the instance data
and its configuration will be exported under the
/srv/ganeti/exports/\fIinstance\fR
directory on the target node.
.PP
The \fB--noshutdown\fR option will create a
snapshot disk of the instance without shutting it down first.
While this is faster and involves no downtime, it cannot be
guaranteed that the instance data will be in a consistent state
in the exported dump.
.PP
Example:

.nf
# gnt-backup export -n node1.example.com instance3.example.com
        
.fi
.SS "IMPORT"

\fBimport\fR { \fB-n \fInode[:secondary-node]\fB\fR | \fB--iallocator \fIname\fB\fR }
    [ \fB-s \fIdisksize\fB\fR ] [ \fB--swap-size \fIdisksize\fB\fR ] [ \fB-m \fImemsize\fB\fR ]
    [ \fB--cpu \fIvcpus\fB\fR ] [ \fB--ip { default | none | \fIip-address\fB }\fR ]
    [ \fB-b \fIbridge\fB\fR ] [ \fB--no-wait-for-sync\fR ] [ \fB--no-ip-check\fR ]
    \fB--src-node=\fIsource-node\fB\fR \fB--src-dir=\fIsource-dir\fB\fR
    \fB-t [ diskless | plain | local_raid1 | remote_raid1 | drbd ]\fR
    \fB\fIinstance\fB\fR

.PP
Imports a new instance from an export residing on
\fIsource-node\fR in
\fIsource-dir\fR\&.
\fIinstance\fR must be in DNS and
resolve to a IP in the same network as the nodes in the
cluster.
.PP
The \fB-s\fR option specifies the disk size for
the instance, in mebibytes (defaults to
20480MiB =
20GiB). You can also use one of the
suffixes m, g or
t to specificy the exact the units used;
these suffixes map to mebibytes, gibibytes and tebibytes.
.PP
The \fB--swap-size\fR option specifies the swap
disk size (in mebibytes) for the instance (the one presented
as \fI/dev/sdb\fR). The
default is 4096MiB\&. As for the disk
size, you can specify other suffixes.
.PP
The \fB-m\fR option specifies the memory size for
the instance, in mebibytes (defaults to 128 MiB). Again, you
can use other suffixes (e.g. \fB2g\fR).
.PP
The \fB-b\fR option specifies the bridge to which the
instance will be connected. (defaults to the cluster-wide default
bridge specified at cluster intialization time).
.PP
The \fB-t\fR options specifies the disk layout type for
the instance. The available choices are:
.TP
\fBdiskless\fR
This creates an instance with no disks. Its useful for
testing only (or other special cases).
.TP
\fBplain\fR
Disk devices will be logical volumes.
.TP
\fBlocal_raid1\fR
Disk devices will be md raid1 arrays over two local
logical volumes.
.TP
\fBremote_raid1\fR
Disk devices will be md raid1 arrays with one
component (so it's not actually raid1): a drbd (0.7.x)
device between the instance's primary node and the
node given by the second value of the
\fB--node\fR option.
.TP
\fBdrbd\fR
Disk devices will be drbd (version 8.x) on top of lvm
volumes. They are equivalent in functionality to
\fIremote_raid1\fR, but are
recommended for new instances (if you have drbd 8.x
installed).
.PP
The \fB--iallocator\fR option specifies the instance
allocator plugin to use. If you pass in this option the allocator will
select nodes for this instance automatically, so you don't need to pass
them with the \fB-n\fR option. For more information please
refer to the instance allocator documentation.
.PP
The optional second value of the \fB--node\fR is used for
the remote raid template type and specifies the remote node.
.PP
If you do not want gnt-backup to wait for the disk mirror
to be synced, use the \fB--no-wait-for-sync\fR
option.
.PP
Use the \fB--cpu\fR option to set the number of virtual
CPUs.
.PP
To pass an IPv4 address to the hypervisor, specify the
\fB--ip\fR option. Note that this IP address will not be
used by the OS scripts and changing it later will change the address
that the instance will actually use.
.PP
Ganeti will not check whether an instance's IP address is already
alive if the \fB--no-ip-check\fR option is specified.
.PP
Example:

.nf
# gnt-backup import -t plain -s 30 -m 512 -n node1.example.com \\
> --src-node=node2.example.com \\
> --src-dir=/srv/ganeti/exports/instance3.example.com \\
> instance3.example.com
        
.fi
.SS "LIST"

\fBlist\fR [ \fB--node=\fINODE\fB\fR ]

.PP
Lists the exports currently available in the default directory
in all the nodes of the current cluster, or optionally only a
subset of them specified using the \fB--node\fR
option (which can be used multiple times)
.PP
Example:

.nf
# gnt-backup list --nodes node1 --nodes node2
.fi
.SH "REPORTING BUGS"
.PP
Report bugs to http://code.google.com/p/ganeti/ or contact the
developers using the ganeti mailing list
<ganeti@googlegroups.com>\&.
.SH "SEE ALSO"
.PP
Ganeti overview and specifications:
\fBganeti\fR(7) (general overview),
\fBganeti-os-interface\fR(7) (guest OS definitions).
.PP
Ganeti commands:
\fBgnt-cluster\fR(8) (cluster-wide commands),
\fBgnt-node\fR(8) (node-related commands),
\fBgnt-instance\fR(8) (instance commands),
\fBgnt-os\fR(8) (guest OS commands).
\fBgnt-backup\fR(8) (instance import/export commands).
.PP
Ganeti daemons:
\fBganeti-watcher\fR(8) (automatic instance restarter),
\fBganeti-noded\fR(8) (node daemon),
\fBganeti-master\fR(8) (the master startup script),
\fBganeti-rapi\fR(8) (remote API daemon).
.SH "COPYRIGHT"
.PP
Copyright (C) 2006, 2007 Google Inc. Permission is granted to
copy, distribute and/or modify under the terms of the GNU
General Public License as published by the Free Software
Foundation; either version 2 of the License, or (at your option)
any later version.
.PP
On Debian systems, the complete text of the GNU General Public
License can be found in /usr/share/common-licenses/GPL.
