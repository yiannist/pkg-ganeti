.\" This manpage has been automatically generated by docbook2man 
.\" from a DocBook document.  This tool can be found at:
.\" <http://shell.ipoline.com/~elmert/comp/docbook2X/> 
.\" Please send any bug reports, improvements, comments, patches, 
.\" etc. to Steve Cheng <steve@ggi-project.org>.
.TH "GNT-CLUSTER" "8" "16 January 2008" "ganeti 1.2" ""

.SH NAME
gnt-cluster \- ganeti administration, cluster-wide
.SH SYNOPSIS

\fBgnt-cluster \fR \fBcommand\fR [ \fBarguments...\fR ]

.SH "DESCRIPTION"
.PP
The \fBgnt-cluster\fR is used for cluster-wide
administration in the ganeti system.
.SH "COMMANDS"
.SS "ADD-TAGS"

\fBadd-tags\fR [ \fB--from \fIfile\fB\fR ] \fB\fItag\fB\fR\fI ...\fR

.PP
Add tags to the cluster. If any of the tags contains invalid
characters, the entire operation will abort.
.PP
If the \fB--from\fR option is given, the list of
tags will be extended with the contents of that file (each
line becomes a tag). In this case, there is not need to pass
tags on the command line (if you do, both sources will be
used). A file name of - will be interpreted as stdin.
.SS "COMMAND"

\fBcommand\fR [ \fB-n \fInode\fB\fR ] \fB\fIcommand\fB\fR

.PP
Executes a command on all nodes. If the option
\fB-n\fR is not given, the command will be executed
on all nodes, otherwise it will be executed only on the
node(s) specified. Use the option multiple times for running
it on multiple nodes, like:

.nf
          # gnt-cluster command -n node1.example.com -n node2.example.com date
        
.fi
.PP
The command is constructed by concatenating all other command
line arguments. For example, to list the contents of the
\fI/etc\fR directory on all
nodes, run:

.nf
          # gnt-cluster command ls -l /etc
        
.fi
and the command which will be executed will be
"ls -l /etc"
.SS "COPYFILE"

\fBcopyfile\fR [ \fB-n \fInode\fB\fR ] \fB\fIfile\fB\fR

.PP
Copies a file to all or to some nodes. The argument specifies
the source file (on the current system), the
\fB-n\fR argument specifies the target node, or
nodes if the option is given multiple times. If
\fB-n\fR is not given at all, the file will be
copied to all nodes.
Example:

.nf
          # gnt-cluster -n node1.example.com -n node2.example.com copyfile /tmp/test
        
.fi
This will copy the file \fI/tmp/test\fR from
the current node to the two named nodes.
.SS "DESTROY"

\fBdestroy\fR \fB--yes-do-it\fR

.PP
Remove all configuration files related to the cluster, so that
a \fBgnt-cluster init\fR can be done again
afterwards.
.PP
Since this is a dangerous command, you are required to pass
the argument \fI--yes-do-it.\fR
.SS "GETMASTER"

\fBgetmaster\fR

.PP
Displays the current master node.
.SS "INFO"

\fBinfo\fR

.PP
Shows runtime cluster information: cluster name, architecture
(32 or 64 bit), master node, node list and instance list.
.SS "INIT"

\fBinit\fR [ \fB-s \fIsecondary_ip\fB\fR ] [ \fB-b \fIbridge\fB\fR ] \fB\fIclustername\fB\fR

.PP
This commands is only run once initially on the first node of
the cluster. It will initialize the cluster configuration and
setup ssh-keys and more.
.PP
Note that the \fIclustername\fR is not
any random name. It has to be resolvable to an IP address
using DNS, and it is best if you give the fully-qualified
domain name.
.PP
The cluster can run in two modes: single-home or
dual-homed. In the first case, all traffic (both public
traffic, inter-node traffic and data replication traffic) goes
over the same interface. In the dual-homed case, the data
replication traffic goes over the second network. The
\fB-s\fR option here marks the cluster as
dual-homed and its parameter represents this node's address on
the second network. If you initialise the cluster with
\fB-s\fR, all nodes added must have a secondary IP
as well.
.PP
Note that for Ganeti it doesn't matter if the secondary
network is actually a separate physical network, or is done
using tunneling, etc. For performance reasons, it's
recommended to use a separate network, of course.
.PP
The \fB-b\fR option specifies the default bridge
for instances.
.PP
The \fB-t\fR allows to set the hypervisor type of
the cluster. Available hypervisor types are: xen-3.0, fake and
xen-hvm3.1. The default is the xen-3.0 hypervisor.
Note that if you init the cluster with hypervisor-type
xen-hvm3.1 you also need to provide the cluster VNC password
file \fI/etc/ganeti/vnc-cluster-password\fR and
the HVM boot ISO image
\fI/srv/ganeti/iso/hvm-install.iso\fR because
instances created by the experimental HVM support require them.
.SS "LIST-TAGS"

\fBlist-tags\fR

.PP
List the tags of the cluster.
.SS "MASTERFAILOVER"

\fBmasterfailover\fR

.PP
Failover the master role to the current node.
.SS "REMOVE-TAGS"

\fBremove-tags\fR [ \fB--from \fIfile\fB\fR ] \fB\fItag\fB\fR\fI ...\fR

.PP
Remove tags from the cluster. If any of the tags are not
existing on the cluster, the entire operation will abort.
.PP
If the \fB--from\fR option is given, the list of
tags will be extended with the contents of that file (each
line becomes a tag). In this case, there is not need to pass
tags on the command line (if you do, both sources will be
used). A file name of - will be interpreted as stdin.
.SS "RENAME"

\fBrename\fR [ \fB-f\fR ] \fB\fIname\fB\fR

.PP
Renames the cluster and in the process updates the master IP
address to the one the new name resolves to. At least one of
either the name or the IP address must be different, otherwise
the operation will be aborted.
.PP
Note that since this command can be dangerous (especially when
run over SSH), the command will require confirmation unless
run with the \fB-f\fR option.
.SS "SEARCH-TAGS"

\fBsearch-tags\fR \fB\fIpattern\fB\fR

.PP
Searches the tags on all objects in the cluster (the cluster
itself, the nodes and the instances) for a given pattern. The
pattern is interpreted as a regular expression and a search
will be done on it (i.e. the given pattern is not anchored to
the beggining of the string; if you want that, prefix the
pattern with ^).
.PP
If no tags are matching the pattern, the exit code of the
command will be one. If there is at least one match, the exit
code will be zero. Each match is listed on one line, the
object and the tag separated by a space. The cluster will be
listed as \fI/cluster\fR, a node will be listed
as
\fI/nodes/name\fR,
and an instance as
\fI/instances/name\fR\&.
Example:

.nf
# gnt-cluster search time
/cluster ctime:2007-09-01
/nodes/node1.example.com mtime:2007-10-04
.fi
.SS "VERIFY"

\fBverify\fR

.PP
Verify correctness of cluster configuration. This is safe with
respect to running instances, and incurs no downtime of the
instances.
.SS "VERIFY-DISKS"

\fBverify-disks\fR

.PP
The command checks which instances have degraded DRBD disks
and activates the disks of those instances.
.PP
This command is run from the \fBganeti-watcher\fR
tool, which also has a different, complementary algorithm for
doing this check. Together, these two should ensure that DRBD
disks are kept consistent.
.SS "VERSION"

\fBversion\fR

.PP
Show the cluster version.
.SH "REPORTING BUGS"
.PP
Report bugs to http://code.google.com/p/ganeti/ or contact the
developers using the ganeti mailing list
<ganeti@googlegroups.com>\&.
.SH "SEE ALSO"
.PP
Ganeti overview and specifications:
\fBganeti\fR(7) (general overview),
\fBganeti-os-interface\fR(7) (guest OS definitions).
.PP
Ganeti commands:
\fBgnt-cluster\fR(8) (cluster-wide commands),
\fBgnt-node\fR(8) (node-related commands),
\fBgnt-instance\fR(8) (instance commands),
\fBgnt-os\fR(8) (guest OS commands).
\fBgnt-backup\fR(8) (instance import/export commands).
.PP
Ganeti daemons:
\fBganeti-watcher\fR(8) (automatic instance restarter),
\fBganeti-noded\fR(8) (node daemon),
\fBganeti-master\fR(8) (the master startup script).
.SH "COPYRIGHT"
.PP
Copyright (C) 2006, 2007 Google Inc. Permission is granted to
copy, distribute and/or modify under the terms of the GNU
General Public License as published by the Free Software
Foundation; either version 2 of the License, or (at your option)
any later version.
.PP
On Debian systems, the complete text of the GNU General Public
License can be found in /usr/share/common-licenses/GPL.
