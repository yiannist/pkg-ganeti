.\" This manpage has been automatically generated by docbook2man 
.\" from a DocBook document.  This tool can be found at:
.\" <http://shell.ipoline.com/~elmert/comp/docbook2X/> 
.\" Please send any bug reports, improvements, comments, patches, 
.\" etc. to Steve Cheng <steve@ggi-project.org>.
.TH "GNT-BACKUP" "8" "19 October 2010" "Ganeti 2.2" ""

.SH NAME
gnt-backup \- Ganeti instance import/export
.SH SYNOPSIS

\fBgnt-backup \fR \fBcommand\fR [ \fBarguments...\fR ]

.SH "DESCRIPTION"
.PP
The \fBgnt-backup\fR is used for importing and exporting
instances and their configuration from a Ganeti system. It is useful for
backing up instances and also to migrate them between clusters.
.SH "COMMANDS"
.SS "EXPORT"

\fBexport\fR \fB-n \fInode\fB\fR [ \fB--shutdown-timeout=\fIN\fB\fR ] [ \fB--noshutdown\fR ] [ \fB--remove-instance\fR ] [ \fB--ignore-remove-failures\fR ] \fB\fIinstance\fB\fR

.PP
Exports an instance to the target node. All the instance data
and its configuration will be exported under the
/srv/ganeti/export/\fIinstance\fR
directory on the target node.
.PP
The \fB--shutdown-timeout\fR is used to specify how
much time to wait before forcing the shutdown (xm destroy in xen,
killing the kvm process, for kvm). By default two minutes are
given to each instance to stop.
.PP
The \fB--noshutdown\fR option will create a
snapshot disk of the instance without shutting it down first.
While this is faster and involves no downtime, it cannot be
guaranteed that the instance data will be in a consistent state
in the exported dump.
.PP
The \fB--remove\fR option can be used to remove the
instance after it was exported. This is useful to make one last
backup before removing the instance.
.PP
The exit code of the command is 0 if all disks were backed up
successfully, 1 if no data was backed up or if the
configuration export failed, and 2 if just some of the disks
failed to backup. The exact details of the failures will be
shown during the command execution (and will be stored in the
job log). It is recommended that for any non-zero exit code,
the backup is considered invalid, and retried.
.PP
Example:

.nf
# gnt-backup export -n node1.example.com instance3.example.com
        
.fi
.SS "IMPORT"

\fBimport\fR
    { \fB-n \fInode[:secondary-node]\fB\fR | \fB--iallocator
\fIname\fB\fR }
    [ \fB--disk \fIN\fB:size=\fIVAL\fB [ ,mode=\fIro|rw\fB ]\fR\fI ...\fR ]
    [ \fB--net \fIN\fB [ :options\fI ...\fB ]\fR\fI ...\fR | \fB--no-nics\fR ]
    [ \fB-B \fIBEPARAMS\fB\fR ]
    [ \fB-H \fIHYPERVISOR\fB [ : option=\fIvalue\fB\fI ...\fB ]\fR ]
    [ \fB--src-node=\fIsource-node\fB\fR ] [ \fB--src-dir=\fIsource-dir\fB\fR ]
    [ \fB-t [ diskless | plain | drbd | file ]\fR ]
    [ \fB--identify-defaults\fR ]
    \fB\fIinstance\fB\fR

.PP
Imports a new instance from an export residing on
\fIsource-node\fR in
\fIsource-dir\fR\&.
\fIinstance\fR must be in DNS and resolve
to a IP in the same network as the nodes in the cluster. If
the source node and directory are not passed, the last backup
in the cluster is used, as visible with the
\fBlist\fR command.
.PP
The \fBdisk\fR option specifies the parameters for
the disks of the instance. The numbering of disks starts at
zero. For each disk, at least the size needs to be given, and
optionally the access mode (read-only or the default of
read-write) can also be specified.  The size is interpreted
(when no unit is given) in mebibytes. You can also use one of
the suffixes
m, g or
t to specificy the exact the units used;
these suffixes map to mebibytes, gibibytes and tebibytes.
.PP
Alternatively, a single-disk instance can be created via the
\fB-s\fR option which takes a single argument,
the size of the disk. This is similar to the Ganeti 1.2
version (but will only create one disk).
.PP
If no disk information is passed, the disk configuration saved
at export time will be used.
.PP
The minimum disk specification is therefore empty (export
information will be used), a single disk can be specified as
\fB--disk 0:size=20G\fR (or \fB-s
20G\fR when using the \fB-s\fR option),
and a three-disk instance can be specified as
\fB--disk 0:size=20G --disk 1:size=4G --disk
2:size=100G\fR\&.
.PP
The NICs of the instances can be specified via the
\fB--net\fR option. By default, the NIC
configuration of the original (exported) instance will be
reused. Each NIC can take up to three parameters (all
optional):
.TP
\fBmac\fR
either a value or 'generate' to generate a new
unique MAC, or 'auto' to reuse the old MAC
.TP
\fBip\fR
specifies the IP address assigned to the
instance from the Ganeti side (this is not necessarily
what the instance will use, but what the node expects
the instance to use)
.TP
\fBmode\fR
specifies the connection mode for this nic:
routed or bridged.
.TP
\fBlink\fR
in bridged mode specifies the bridge to attach
this NIC to, in routed mode it's intended to
differentiate between different routing tables/instance
groups (but the meaning is dependent on the network
script, see gnt-cluster(8) for more details)
Of these "mode" and "link" are nic parameters, and inherit their
default at cluster level.
.PP
If no network is desired for the instance, you should create a
single empty NIC and delete it afterwards
via \fBgnt-instance modify --net delete\fR\&.
.PP
The \fB-B\fR option specifies the backend
parameters for the instance. If no such parameters are
specified, the values are inherited from the export. Possible
parameters are:
.TP
\fBmemory\fR
the memory size of the instance; as usual,
suffixes can be used to denote the unit, otherwise the
value is taken in mebibites
.TP
\fBvcpus\fR
the number of VCPUs to assign to the instance
(if this value makes sense for the hypervisor)
.TP
\fBauto_balance\fR
whether the instance is considered in the N+1
cluster checks (enough redundancy in the cluster to
survive a node failure)
.PP
The \fB-t\fR options specifies the disk layout type
for the instance. If not passed, the configuration of the
original instance is used. The available choices are:
.TP
\fBdiskless\fR
This creates an instance with no disks. Its useful for
testing only (or other special cases).
.TP
\fBplain\fR
Disk devices will be logical volumes.
.TP
\fBdrbd\fR
Disk devices will be drbd (version 8.x) on top of lvm
volumes.
.TP
\fBfile\fR
Disk devices will be backed up by files, under the
\fI@RPL_FILE_STORAGE_DIR@\fR\&. By
default, each instance will get a directory (as its own
name) under this path, and each disk is stored as
individual files in this (instance-specific)
directory.
.PP
The \fB--iallocator\fR option specifies the instance
allocator plugin to use. If you pass in this option the allocator will
select nodes for this instance automatically, so you don't need to pass
them with the \fB-n\fR option. For more information please
refer to the instance allocator documentation.
.PP
The optional second value of the \fB--node\fR is used for
the drbd template and specifies the remote node.
.PP
Since many of the parameters are by default read from the
exported instance information and used as such, the new
instance will have all parameters explicitly specified, the
opposite of a newly added instance which has most parameters
specified via cluster defaults. To change the import behaviour
to recognize parameters whose saved value matches the current
cluster default and mark it as such (default value), pass
the \fB--identify-defaults\fR option. This will
affect the hypervisor, backend and NIC parameters, both read
from the export file and passed in via the command line.
.PP
Example for identical instance import:

.nf
# gnt-backup import -n node1.example.com instance3.example.com
        
.fi
.PP
Explicit configuration example:

.nf
# gnt-backup import -t plain --disk 0:size=1G -B memory=512 \\
> -n node1.example.com \\
> instance3.example.com
        
.fi
.SS "LIST"

\fBlist\fR [ \fB--node=\fINODE\fB\fR ]

.PP
Lists the exports currently available in the default directory
in all the nodes of the current cluster, or optionally only a
subset of them specified using the \fB--node\fR
option (which can be used multiple times)
.PP
Example:

.nf
# gnt-backup list --nodes node1 --nodes node2
.fi
.SS "REMOVE"

\fBremove\fR \fBinstance_name\fR

.PP
Removes the backup for the given instance name, if any. If the
backup was for a deleted instances, it is needed to pass the
FQDN of the instance, and not only the
short hostname.
.SH "REPORTING BUGS"
.PP
Report bugs to  <URL:http://code.google.com/p/ganeti/> or contact the
developers using the Ganeti mailing list
<ganeti@googlegroups.com>\&.
.SH "SEE ALSO"
.PP
Ganeti overview and specifications:
\fBganeti\fR(7) (general overview),
\fBganeti-os-interface\fR(7) (guest OS definitions).
.PP
Ganeti commands:
\fBgnt-cluster\fR(8) (cluster-wide commands),
\fBgnt-job\fR(8) (job-related commands),
\fBgnt-node\fR(8) (node-related commands),
\fBgnt-instance\fR(8) (instance commands),
\fBgnt-os\fR(8) (guest OS commands),
\fBgnt-backup\fR(8) (instance import/export commands),
\fBgnt-debug\fR(8) (debug commands).
.PP
Ganeti daemons:
\fBganeti-watcher\fR(8) (automatic instance restarter),
\fBganeti-cleaner\fR(8) (job queue cleaner),
\fBganeti-noded\fR(8) (node daemon),
\fBganeti-masterd\fR(8) (master daemon),
\fBganeti-rapi\fR(8) (remote API daemon).
.SH "COPYRIGHT"
.PP
Copyright (C) 2006, 2007, 2008, 2009, 2010 Google Inc. Permission is
granted to copy, distribute and/or modify under the terms of the
GNU General Public License as published by the Free Software
Foundation; either version 2 of the License, or (at your option)
any later version.
.PP
On Debian systems, the complete text of the GNU General Public
License can be found in /usr/share/common-licenses/GPL.
