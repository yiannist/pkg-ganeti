#!/bin/bash

# Helper for running things in a temporary directory; used for docs
# building, unittests, etc.

set -e

tmpdir=$(mktemp -d -t gntbuild.XXXXXXXX)
trap "rm -rf $tmpdir" EXIT

mkdir $tmpdir/doc

cp -r autotools daemons scripts lib tools test qa $tmpdir
cp -r doc/examples $tmpdir/doc

mv $tmpdir/lib $tmpdir/ganeti
ln -T -s $tmpdir/ganeti $tmpdir/lib
mkdir -p $tmpdir/htools
for htest in htools hpc-htools test offline-test.sh cli-tests-defs.sh; do
  if [ -e htools/$htest ]; then
    cp -p htools/$htest $tmpdir/htools/
  fi
done

cd $tmpdir && GANETI_TEMP_DIR="$tmpdir" "$@"
